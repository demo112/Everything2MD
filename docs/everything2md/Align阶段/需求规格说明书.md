# Everything2MD 需求规格说明书

## 1. 项目概述

### 1.1 项目背景

Everything2MD 是一个文档转换工具，旨在将各种办公文档格式统一转换为 Markdown 格式，简化文档处理流程，提高文档的可移植性和可编辑性。

### 1.3 依赖组件与技术栈

**核心依赖：**

- **LibreOffice** ≥ 7.0用于打开并转存 .doc/.docx 为中间格式（如 HTML），保证样式与结构完整。
- **Pandoc** ≥ 3.0通用文档转换引擎，负责将中间格式统一输出为 Markdown，支持扩展语法。
- **pptx2md**（最新 PyPI 版）
  专门针对 PPTX 的 Python 解析库，保留母版、备注、层级列表等细节。

**辅助技术：**

- **Bash 4+**脚本运行环境，提供数组/关联数组、进程替换等现代特性，保证 macOS / Linux / WSL 一致体验。
- **Python 3.8+（可选运行时）**若系统未预装 pipx，脚本自动调用 python3 -m venv 创建隔离环境并安装 pptx2md，避免污染系统包。
- **GNU coreutils / findutils**批量模式下依赖 xargs、find、stat 等命令进行跨平台文件收集与并行调度。
- **临时文件管理**
  使用 mktemp、trap 确保中间产物及时清理；大文件（>10 MB）采用分块缓存，内存峰值 ≤ 500 MB。

**技术栈选型理由：**

1. 全部组件均为开源且跨平台，可通过包管理器一键安装，降低用户门槛。
2. LibreOffice + Pandoc 组合对 Word 兼容性最佳，社区文档丰富，升级路径清晰。
3. pptx2md 原生支持 Python，可二次扩展（如提取演讲者备注、母版图片），为后续插件化预留接口。
4. 纯 Bash 实现核心流程，零编译、秒级启动；性能热点（如批量遍历）用 xargs -P 并行，兼顾开发效率与运行效率。
5. 所有外部调用均封装为函数，统一版本检测与降级策略，后续若替换为 API 服务只需改动适配层即可。

**版本锁定与升级策略：**

- 脚本启动时执行 `libreoffice --version`、`pandoc --version`、`pip show pptx2md` 三重校验，低于最低要求则给出安装命令并退出。
- 提供 `.tool-versions` 与 `requirements.txt` 样例，方便 CI 或容器一次性还原相同环境。
- 每个正式 Release 在 GitHub 发布页附带组件兼容性矩阵，确保升级可预期、可回滚。

### 1.2 项目目标

- 提供统一的文档转换解决方案
- 支持多种主流办公文档格式
- 保持转换质量和格式完整性
- 提供简单易用的命令行界面

## 2. 需求定义

### 2.1 功能需求

#### 2.1.1 文件格式支持

**核心支持格式：**

- Microsoft Word 文档（.doc, .docx）
- Microsoft PowerPoint 演示文稿（.pptx、.ppt）

**扩展支持格式：**

- 纯文本文件（.txt）- 直接复制
- Markdown 文件（.md, .markdown）- 直接复制

**不支持格式（基于技术限制）：**

- PDF 文件（Pandoc 无法直接处理）

#### 2.1.2 转换模式

**单文件转换：**

- 支持单个文件转换
- 可选指定输出文件名
- 默认输出与输入文件同名（扩展名改为 .md）

**批量转换（后续版本）：**

- 支持目录批量处理
- 可选递归子目录
- 保持原始目录结构
- 提供转换进度和统计信息

#### 2.1.3 转换质量要求

**基本要求：**

- 保留文档的基本文本结构
- 保持段落层次关系
- 转换成功率 ≥ 95%

**格式保留：**

- 标题层级（H1-H6）
- 列表结构（有序/无序）
- 表格结构（基础格式）
- 粗体、斜体等基础格式

### 2.2 非功能需求

#### 2.2.1 性能要求

**转换速度：**

- 小文件（<1MB）：≤ 10秒
- 中等文件（1-10MB）：≤ 60秒
- 大文件（>10MB）：≤ 300秒

**资源使用：**

- 内存占用：≤ 500MB（单文件）
- 临时文件：自动清理

#### 2.2.2 可靠性要求

**成功率指标：**

- 有效文件转换成功率 ≥ 95%
- 程序异常退出率 ≤ 1%
- 数据丢失率 = 0%

**错误处理：**

- 详细的错误信息和解决建议
- 转换失败时保留原始文件
- 支持错误恢复和重试机制

#### 2.2.3 易用性要求

**命令行界面：**

- 直观的参数设计
- 清晰的帮助信息
- 友好的错误提示

**文档要求：**

- 详细的安装指南
- 完整的使用说明
- 常见问题解答

### 2.3 技术约束

#### 2.3.1 组件使用约束

**必须使用组件：**

- LibreOffice：处理 doc、docx、ppt 文档格式
- Pandoc：文档格式转换
- pptx2md：专门处理 PPTX 格式

**使用方式：**

- 使用系统已安装版本
- 不在项目中包含组件源码
- 不修改组件源代码

#### 2.3.2 平台兼容性

**支持平台：**

- macOS（主要开发平台）
- Linux（Ubuntu/CentOS）
- Windows（通过 WSL 或 Git Bash）

**环境要求：**

- Bash 4.0+
- 各组件命令行可用
- 充足的磁盘空间（临时文件）

## 3. 用户故事

### 3.1 主要用户场景

#### 场景1：研究人员文档整理

**用户：** 学术研究人员
**需求：** 将大量 Word 文档转换为 Markdown，便于版本控制和协作
**价值：** 统一文档格式，支持 Git 版本管理

#### 场景2：技术写作团队

**用户：** 技术文档编写团队
**需求：** 将客户提供的各种格式文档转换为团队标准格式
**价值：** 简化文档处理流程，提高团队效率

#### 场景3：个人知识管理

**用户：** 知识工作者
**需求：** 将分散的文档转换为统一格式，建立个人知识库
**价值：** 便于搜索、链接和长期维护

### 3.2 使用流程

#### 单文件转换流程

```
用户输入命令 → 参数解析 → 文件类型检测 → 选择转换路径 → 
执行转换 → 质量验证 → 输出结果 → 清理临时文件
```

#### 批量转换流程（后续版本）

```
用户输入命令 → 参数解析 → 文件收集 → 转换计划 → 
逐个转换 → 进度显示 → 结果统计 → 生成报告
```

## 4. 验收标准

### 4.1 功能验收标准

#### 4.1.1 格式支持验收

- [X] 能够正确识别 .doc, .docx, .pptx , .ppt文件格式
- [X] 能够成功转换有效的 Office 文档
- [X] 转换后的 Markdown 文件包含有效内容
- [X] 转换过程不损坏原始文件

#### 4.1.2 质量验收标准

- [X] 转换后的文档保留基本结构
- [X] 文本内容完整，无乱码
- [X] 格式转换成功率 ≥ 95%
- [X] 错误处理机制完善

#### 4.1.3 易用性验收

- [X] 命令行参数设计合理
- [X] 帮助信息清晰完整
- [X] 错误提示友好有用
- [X] 安装配置简单明了

### 4.2 技术验收标准

#### 4.2.1 代码质量

- [X] 模块化设计，结构清晰
- [X] 错误处理完善
- [X] 代码注释充分
- [X] 符合 Shell 脚本最佳实践

#### 4.2.2 测试覆盖

- [X] 核心功能有测试用例
- [X] 边界条件有测试覆盖
- [X] 错误情况有测试验证
- [X] 测试自动化程度高

#### 4.2.3 文档完整性

- [X] 需求文档完整准确
- [X] 设计文档详细清晰
- [X] 用户文档易于理解
- [X] 部署文档操作性强

## 5. 需求变更历史

### 5.1 主要调整

#### 5.1.1 格式支持调整

**原始需求：** 支持 .doc, .docx, .ppt, .pptx, .pdf
**调整后：** 支持 .doc, .docx, .pptx（移除 .ppt 和 .pdf）
**原因：**

- Pandoc 无法直接处理 PDF 文件
- pptx2md 不支持旧版 .ppt 格式
- 专注于核心可实现的格式

#### 5.1.2 批量转换调整

**原始需求：** 完整支持批量转换
**调整后：** 优先实现单文件转换，批量转换作为后续功能
**原因：**

- 单文件转换是基础功能
- 批量转换复杂度较高
- 分阶段实现降低风险

### 5.2 技术方案演进

#### 5.2.1 组件集成方式

**初始方案：** Fork 组件源码到项目中
**最终方案：** 使用系统已安装版本
**优势：**

- 项目结构简化
- 跨平台兼容性更好
- 维护成本降低

#### 5.2.2 架构设计优化

**初始设计：** 简单的线性流程
**优化设计：** 模块化分层架构
**改进：**

- 增加了依赖检查
- 完善了错误处理
- 优化了临时文件管理

## 6. 风险与假设

### 6.1 技术风险

#### 6.1.1 转换质量风险

**风险：** Pandoc 处理 PDF 的能力有限，可能影响转换质量
**应对：** 提供降级处理方案，优先保证文本内容转换

#### 6.1.2 组件兼容性风险

**风险：** 不同版本的组件可能存在兼容性问题
**应对：** 指定推荐的组件版本，提供版本检测功能

### 6.2 业务假设

#### 6.2.1 用户环境假设

**假设：** 用户能够安装和配置所需的组件
**验证：** 提供详细的安装指南和依赖检查工具

#### 6.2.2 文件质量假设

**假设：** 输入的文档是有效的 Office 文档格式
**处理：** 增加文件格式验证和错误处理机制

## 7. 后续规划

### 7.1 短期优化（1-2个月）

- 完善批量转换功能
- 增强错误处理和恢复机制
- 优化转换质量和性能

### 7.2 中期扩展（3-6个月）

- 支持更多文档格式
- 增加配置选项和自定义功能
- 提供图形用户界面

### 7.3 长期发展（6个月以上）

- 建立插件架构支持扩展
- 提供在线服务和 API
- 构建文档转换生态
