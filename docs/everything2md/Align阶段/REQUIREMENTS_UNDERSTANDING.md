# Everything2MD 需求理解与边界确认

## 原始需求回顾

Everything2MD 是一个文档转换工具，旨在将各种办公文档格式统一转换为 Markdown 格式，简化文档处理流程，提高文档的可移植性和可编辑性。

### 核心功能需求

1. 支持多种办公文档格式转换为 Markdown
2. 保持转换质量和格式完整性
3. 提供简单易用的命令行界面

### 格式支持需求

#### 核心支持格式

- Microsoft Word 文档（.doc, .docx）
- Microsoft PowerPoint 演示文稿（.pptx, .ppt）

#### 扩展支持格式

- 纯文本文件（.txt）- 直接复制
- Markdown 文件（.md, .markdown）- 直接复制

#### 关于PDF格式的说明

需要澄清的是，在需求理解中提到的"不支持PDF格式"是指不支持将PDF作为**输入**格式，而不是完全不处理PDF。实际上，在技术实现中，PDF被用作中间格式：

1. **Office文档处理流程**：.doc/.docx/.ppt 文件首先通过LibreOffice转换为PDF中间格式
2. **PDF转换流程**：然后通过Pandoc将PDF中间格式转换为Markdown

所以这里的"不支持PDF格式"应该理解为：不支持将PDF文件作为直接输入源进行转换，但在内部处理流程中会生成和使用PDF作为中间格式。

## 需求理解确认

### 对现有项目的理解

1. **项目成熟度**：项目已完成核心功能开发和测试验证，具备可用的文档体系。
2. **技术实现**：

   - 采用了组件集成的方式，依赖系统已安装的 LibreOffice、Pandoc 和 pptx2md
   - 实现了模块化架构，包括参数解析、文件类型检测、不同格式的转换器等
   - 具备完善的错误处理和降级策略
   - 实现了依赖检查机制，确保运行环境符合要求
3. **当前局限性**：

   - 尚未实现批量处理功能
   - 缺少配置文件系统
   - 用户界面仅限命令行

### 项目边界确认

#### 功能边界

1. **支持的转换方向**：

   - 输入：.doc, .docx, .pptx, .txt, .md, .markdown
   - 输出：统一为 Markdown (.md) 格式
2. **不支持的功能**：

   - Markdown 转换为其他格式
   - PDF 文件作为输入
   - 旧版 Office 文件（.ppt）的支持
3. **处理范围**：

   - 单文件转换（已实现）
   - 批量转换（计划中）
   - 不包括文件编辑功能

#### 技术边界

1. **平台支持**：

   - macOS（主要开发平台）
   - Linux（Ubuntu/CentOS）
   - Windows（通过 WSL 或 Git Bash）
2. **环境要求**：

   - Bash 4.0+
   - LibreOffice ≥ 7.0
   - Pandoc ≥ 3.0
   - Python 3.8+（用于运行 pptx2md）
3. **性能边界**：

   - 小文件（<1MB）：≤ 10秒
   - 中等文件（1-10MB）：≤ 60秒
   - 大文件（>10MB）：≤ 300秒
   - 内存占用：≤ 500MB（单文件）

#### 用户边界

1. **目标用户群体**：

   - 学术研究人员：需要将大量 Word 文档转换为 Markdown，便于版本控制和协作
   - 技术文档编写团队：需要将客户提供的各种格式文档转换为团队标准格式
   - 知识工作者：需要将分散的文档转换为统一格式，建立个人知识库
2. **用户技能要求**：

   - 具备基本的命令行操作能力
   - 能够安装和配置所需依赖组件
   - 理解 Markdown 格式的基本概念

## 疑问澄清

在分析过程中，发现以下几个需要进一步明确的问题：

### 1. 批量处理的具体需求

- 支持目录批量处理
- 支持递归子目录处理
- 提供输出目录结构组织选择（保持原目录结构 vs 扁平化）
- 提供处理进度显示
- 失败文件处理（跳过并记录）
- 生成处理报告

### 2. 配置系统的具体需求

- 支持 JSON 格式配置文件，预留 YAML 解析接口
- 支持环境变量配置
- 配置优先级：命令行参数 > 配置文件 > 环境变量 > 内置默认值
- 提供配置验证机制（JSON Schema）
- 支持配置选项包括：
  - 输入/输出路径
  - 递归深度与目录结构保持开关
  - 并发数与内存上限
  - 日志级别与日志文件位置
  - 组件（LibreOffice、Pandoc、pptx2md）可执行文件路径
  - 重试次数与超时时间
  - 质量阈值与缓存开关

### 3. 错误处理的详细需求

- 提供详细的错误信息和解决建议
- 转换失败时保留原始文件
- 支持错误恢复和重试机制
- 提供日志记录功能
- 支持断点续传功能
- 权限不足时拒绝执行并提示
- 支持日志级别设置（debug, info, warn, error）

### 4. 性能优化的具体需求

- 实现内存管理，避免内存泄漏
- 及时清理临时文件
- 支持并发处理（可选）
- 支持大文件处理（默认1GB内存限制，可配置）
- 支持并发处理（默认4个并发线程，可配置）
- 实现缓存机制避免重复处理（默认开启，可配置）
- 支持处理进度实时反馈（默认开启，可配置）

## 需求优先级建议

基于现有文档和项目状态，建议按以下优先级处理后续功能：

### 高优先级

1. 配置文件系统
2. 环境变量支持
3. Excel 格式支持

### 中优先级

1. 批量处理优化（并发处理、断点续传）
2. 用户体验改进（进度显示、结果预览）
3. 性能优化（大文件处理、缓存机制）

### 低优先级

1. 图形化界面
2. Web 界面
3. 更多格式支持（PDF、图片提取等）
