# Everything2MD 项目共识文档

## 1. 明确的需求描述

### 1.1 项目目标

Everything2MD 是一个文档转换工具，旨在将各种办公文档格式统一转换为 Markdown 格式，简化文档处理流程，提高文档的可移植性和可编辑性。

项目已完成需求分析、技术设计和文档体系建设，但尚未进入实际开发阶段。

### 1.2 核心功能需求

1. 支持多种办公文档格式转换为 Markdown
2. 保持转换质量和格式完整性
3. 提供简单易用的命令行界面
4. 实现批量处理功能：
   - 支持递归子目录处理
   - 提供输出目录结构组织选择（保持原目录结构 vs 扁平化）
   - 提供处理进度显示
   - 失败文件处理（跳过并记录）
   - 生成处理报告
5. 提供配置选项：
   - 支持 JSON 格式配置文件
   - 配置优先级：命令行参数 > 配置文件 > 环境变量 > 内置默认值
   - 支持配置文件验证机制（JSON Schema）

### 1.3 格式支持需求

#### 1.3.1 核心支持格式

- Microsoft Word 文档（.doc, .docx）
- Microsoft PowerPoint 演示文稿（.pptx, .ppt）

#### 1.3.2 扩展支持格式

- 纯文本文件（.txt）- 直接复制
- Markdown 文件（.md, .markdown）- 直接复制

#### 1.3.3 计划支持格式

- Microsoft Excel 电子表格（.xlsx）- 计划中
- PDF 文件 - 不支持作为输入格式，但在内部处理流程中作为中间格式使用

#### 1.3.4 不支持格式

- 其他专有格式（基于技术限制）

## 2. 技术实现方案

### 2.1 整体架构

保持现有模块化分层架构：

```
用户输入 → 参数解析器 → 文件类型检测 → 选择转换路径 → 执行转换 → 质量验证 → 输出结果 → 清理临时文件
```

### 2.2 核心组件

1. **参数解析器**：处理命令行参数和配置文件
2. **文件类型检测**：根据文件扩展名确定处理路径
3. **LibreOffice转换器**：处理 .doc, .docx, .ppt 文件
4. **pptx2md转换器**：处理 .pptx 文件
5. **Pandoc转换器**：将中间格式转换为 Markdown
6. **直接复制模块**：处理 .txt 和 .md 文件
7. **依赖检查系统**：验证运行环境
8. **批量处理模块**：实现批量文件处理功能
9. **配置管理系统**：处理用户配置选项
   - 支持 JSON 格式配置文件，预留 YAML 解析接口
   - 配置优先级：命令行参数 > 配置文件 > 环境变量 > 内置默认值
   - 支持配置文件验证机制（JSON Schema）
   - 支持配置选项包括：
     - 输入/输出路径
     - 递归深度与目录结构保持开关
     - 并发数与内存上限
     - 日志级别与日志文件位置
     - 组件（LibreOffice、Pandoc、pptx2md）可执行文件路径
     - 重试次数与超时时间
     - 质量阈值与缓存开关

### 2.3 技术约束和集成方案

1. **组件使用约束**：

   - 必须使用系统已安装版本的组件
   - 不在项目中包含组件源码
   - 不修改组件源代码
   - 支持组件版本配置（默认要求最低版本，可配置）
   - 支持不同版本的降级处理（默认支持，可配置）
2. **平台兼容性**：

   - macOS（主要开发平台）
   - Linux（Ubuntu/CentOS）
   - Windows（通过 WSL 或 Git Bash）
3. **环境要求**：

   - Bash 4.0+
   - LibreOffice ≥ 7.0
   - Pandoc ≥ 3.0
   - Python 3.8+（用于运行 pptx2md）
4. **跨平台支持细节**：

   - Windows 平台支持仅限于 WSL 和 Git Bash（默认设置，可配置）
   - 不同平台的兼容性问题建议用户手动安装组件或联系项目维护者获取帮助

## 3. 任务边界限制

### 3.1 功能边界

1. **支持的转换方向**：

   - 输入：.doc, .docx, .pptx, .ppt, .txt, .md, .markdown, .xlsx（计划）
   - 输出：统一为 Markdown (.md) 格式
2. **处理范围**：

   - 单文件转换
   - 批量转换（目录处理）
   - 不包括文件编辑功能

### 3.2 技术边界

1. **性能要求**：

   - 小文件（<1MB）：≤ 10秒
   - 中等文件（1-10MB）：≤ 60秒
   - 大文件（>10MB）：≤ 300秒
   - 内存占用：≤ 500MB（单文件）
2. **可靠性要求**：

   - 转换成功率：≥ 95%
   - 程序异常退出率：≤ 1%
   - 数据丢失率：= 0%

### 3.3 用户边界

1. **目标用户群体**：

   - 学术研究人员
   - 技术文档编写团队
   - 知识工作者
2. **用户技能要求**：

   - 具备基本的命令行操作能力
   - 能够安装和配置所需依赖组件

## 4. 验收标准

### 4.1 功能验收标准

1. **格式支持验收**：

   - [ ] 能够正确识别并转换 .doc, .docx, .pptx, .ppt 文件
   - [ ] 能够正确处理 .txt, .md 文件（直接复制）
   - [ ] 转换后的 Markdown 文件包含有效内容
   - [ ] 转换过程不损坏原始文件
2. **批量处理验收**：

   - [ ] 支持目录批量处理
   - [ ] 支持递归子目录处理
   - [ ] 提供输出目录结构组织选择（保持原目录结构 vs 扁平化）
   - [ ] 提供处理进度显示
   - [ ] 失败文件处理（跳过并记录）
   - [ ] 生成处理报告
3. **配置管理验收**：

   - [ ] 支持 JSON 格式配置文件
   - [ ] 支持环境变量配置
   - [ ] 配置优先级正确（命令行 > 配置文件 > 环境变量 > 默认值）
   - [ ] 提供配置验证机制（JSON Schema）
   - [ ] 支持配置选项包括：
     - 输入/输出路径
     - 递归深度与目录结构保持开关
     - 并发数与内存上限
     - 日志级别与日志文件位置
     - 组件（LibreOffice、Pandoc、pptx2md）可执行文件路径
     - 重试次数与超时时间
     - 质量阈值与缓存开关

### 4.2 质量验收标准

1. **转换质量**：

   - [ ] 转换后的文档保留基本结构
   - [ ] 文本内容完整，无乱码
   - [ ] 格式转换成功率 ≥ 95%
   - [ ] 支持质量验证和降级处理
2. **错误处理**：

   - [ ] 详细的错误信息和解决建议
   - [ ] 转换失败时保留原始文件
   - [ ] 支持错误恢复和重试机制
   - [ ] 提供日志记录功能
   - [ ] 支持断点续传功能
   - [ ] 权限不足时拒绝执行并提示
   - [ ] 支持日志级别设置（debug, info, warn, error）
3. **易用性**：

   - [ ] 命令行参数设计合理（短横线 - 作为参数前缀，长横线 -- 作为长参数前缀）
   - [ ] 支持简写参数（例如：-i 输入路径，-o 输出路径）
   - [ ] 默认行为明确（默认输出到标准输出，可配置）
   - [ ] 支持管道输入（例如：cat input.docx | everything2md -o output.md）
   - [ ] 帮助信息清晰完整（包含参数说明、使用示例、错误处理建议等）
   - [ ] 提供使用示例帮助用户快速上手
   - [ ] 错误提示友好有用
   - [ ] 安装配置简单明了

### 4.3 技术验收标准

1. **代码质量**：

   - [ ] 模块化设计，结构清晰
   - [ ] 错误处理完善
   - [ ] 代码注释充分
   - [ ] 符合 Shell 脚本最佳实践
2. **测试覆盖**：

   - [ ] 核心功能有测试用例
   - [ ] 边界条件有测试覆盖
   - [ ] 错误情况有测试验证
   - [ ] 测试自动化程度高（代码覆盖率 > 80%）
   - [ ] 支持集成测试，确保组件间协同工作正常
3. **文档完整性**：

   - [ ] 需求文档完整准确
   - [ ] 设计文档详细清晰
   - [ ] 用户文档易于理解
   - [ ] 部署文档操作性强
4. **性能优化**：

   - [ ] 支持大文件处理（默认1GB内存限制，可配置）
   - [ ] 支持并发处理（默认4个并发线程，可配置）
   - [ ] 实现缓存机制避免重复处理（默认开启，可配置）
   - [ ] 支持处理进度实时反馈（默认开启，可配置）

## 5. 关键假设确认

### 5.1 技术假设

1. 用户能够安装和配置所需的组件
2. 输入的文档是有效的 Office 文档格式
3. 系统有足够的磁盘空间存储临时文件

### 5.2 业务假设

1. 用户主要关注文档格式转换功能
2. 命令行界面是主要交互方式
3. 批量处理是重要但非核心功能

## 6. 风险评估与应对

### 6.1 技术风险

1. **转换质量风险**：

   - 风险：Pandoc 处理复杂格式的能力有限，可能影响转换质量
   - 应对：提供降级处理方案，优先保证文本内容转换
2. **组件兼容性风险**：

   - 风险：不同版本的组件可能存在兼容性问题
   - 应对：指定推荐的组件版本，提供版本检测功能

### 6.2 实施风险

1. **时间风险**：

   - 风险：功能开发时间可能超出预期
   - 应对：采用分阶段实现，优先完成核心功能
2. **资源风险**：

   - 风险：开发资源可能不足
   - 应对：合理规划优先级，确保高价值功能优先实现

## 7. 后续规划建议

### 7.1 短期规划（1-2个月）

1. 实现配置文件系统
2. 完善批量转换功能
3. 增强错误处理和恢复机制

### 7.2 中期规划（3-6个月）

1. 支持 Excel 格式转换
2. 增加性能优化（并发处理、缓存机制）
3. 提供图形用户界面

### 7.3 长期规划（6个月以上）

1. 建立插件架构支持扩展
2. 提供在线服务和 API
3. 构建文档转换生态
