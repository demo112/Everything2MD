# Everything2MD æŠ€æœ¯è®¾è®¡æ–‡æ¡£

## 1. ç³»ç»Ÿæ¶æ„è®¾è®¡

### 1.1 æ•´ä½“æ¶æ„

```mermaid
graph TD
    A[ç”¨æˆ·è¾“å…¥] --> B[å‚æ•°è§£æå™¨]
    B --> C{æ–‡ä»¶ç±»å‹æ£€æµ‹}
    C -->|Officeæ–‡ä»¶| D[LibreOfficeè½¬æ¢å™¨]
    C -->|PPTXæ–‡ä»¶| E[pptx2mdè½¬æ¢å™¨]
    C -->|æ–‡æœ¬æ–‡ä»¶| F[ç›´æ¥å¤åˆ¶]
    C -->|å…¶ä»–æ–‡ä»¶| G[é”™è¯¯å¤„ç†]
    
    D --> H[PDFä¸­é—´æ–‡ä»¶]
    H --> I[Pandocè½¬æ¢å™¨]
    I --> J[Markdownè¾“å‡º]
    
    E --> J
    F --> J
    G --> K[é”™è¯¯æç¤º]
    
    L[ä¾èµ–æ£€æŸ¥] --> B
    L -.->|å¤±è´¥| M[ä¾èµ–ç¼ºå¤±æç¤º]
    
    N[é”™è¯¯å¤„ç†] --> K
    O[æ—¥å¿—è®°å½•] --> B
```

### 1.2 æ ¸å¿ƒç»„ä»¶å…³ç³»

```mermaid
graph TD
    A[ç”¨æˆ·è¾“å…¥] --> B[å‚æ•°è§£æå™¨]
    B --> C{æ–‡ä»¶ç±»å‹æ£€æµ‹}
    C -->|Officeæ–‡ä»¶<br/>.doc, .docx| D[LibreOfficeè½¬æ¢å™¨]
    C -->|PPTXæ–‡ä»¶| E[pptx2mdè½¬æ¢å™¨]
    C -->|æ–‡æœ¬æ–‡ä»¶<br/>.txt, .md| F[ç›´æ¥å¤åˆ¶]
    C -->|ä¸æ”¯æŒæ ¼å¼| G[é”™è¯¯å¤„ç†]
    
    D --> H[PDFä¸­é—´æ–‡ä»¶]
    H --> I[Pandocè½¬æ¢å™¨]
    I --> J[Markdownè¾“å‡º]
    
    E --> J
    F --> J
    G --> K[é”™è¯¯æç¤º]
    
    L[ä¾èµ–æ£€æŸ¥] -.->|å¤±è´¥| M[ä¾èµ–ç¼ºå¤±æç¤º]
    
    N[é”™è¯¯å¤„ç†] --> K
    O[æ—¥å¿—è®°å½•] --> B
    P[ä¸´æ—¶æ–‡ä»¶ç®¡ç†] --> D
    P --> E
    P --> I
    P -->|æ¸…ç†| Q[èµ„æºå›æ”¶]
    
    R[è´¨é‡éªŒè¯] -->|éªŒè¯å¤±è´¥| S[é™çº§å¤„ç†]
    S --> J
```



#### 1.2.1 ç»„ä»¶æ¥å£è¯´æ˜

**å‚æ•°è§£æå™¨**
- æ¥æ”¶ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤è¡Œå‚æ•°
- è§£ææ–‡ä»¶è·¯å¾„ã€è¾“å‡ºè·¯å¾„å’Œå…¶ä»–é€‰é¡¹
- éªŒè¯å‚æ•°çš„æœ‰æ•ˆæ€§

**æ–‡ä»¶ç±»å‹æ£€æµ‹**
- æ ¹æ®æ–‡ä»¶æ‰©å±•ååˆ¤æ–­æ–‡ä»¶ç±»å‹
- æ”¯æŒçš„ç±»å‹ï¼š.doc, .docx, .pptx, .txt, .md
- å¯¹ä¸æ”¯æŒçš„æ ¼å¼è§¦å‘é”™è¯¯å¤„ç†æµç¨‹

**LibreOfficeè½¬æ¢å™¨**
- æ¥æ”¶Officeæ–‡æ¡£(.doc, .docx)ä½œä¸ºè¾“å…¥
- è°ƒç”¨LibreOfficeå°†æ–‡æ¡£è½¬æ¢ä¸ºPDFæ ¼å¼
- è¾“å‡ºPDFä¸­é—´æ–‡ä»¶ä¾›ä¸‹ä¸€æ­¥å¤„ç†

**pptx2mdè½¬æ¢å™¨**
- ä¸“é—¨å¤„ç†.pptxæ–‡ä»¶
- è°ƒç”¨pptx2mdåº“è¿›è¡Œè½¬æ¢
- ç›´æ¥è¾“å‡ºMarkdownæ ¼å¼

**Pandocè½¬æ¢å™¨**
- æ¥æ”¶PDFæ–‡ä»¶ä½œä¸ºè¾“å…¥
- è°ƒç”¨Pandocå°†PDFè½¬æ¢ä¸ºMarkdown
- è¾“å‡ºæœ€ç»ˆçš„Markdownæ–‡ä»¶

**ç›´æ¥å¤åˆ¶**
- å¤„ç†.txtå’Œ.mdæ–‡ä»¶
- ç›´æ¥å¤åˆ¶æ–‡ä»¶åˆ°è¾“å‡ºä½ç½®
- ä¿æŒåŸæœ‰æ ¼å¼ä¸å˜

#### 1.2.2 æ•°æ®æµå‘è¯´æ˜

1. **Officeæ–‡æ¡£å¤„ç†æµç¨‹**ï¼š
   ç”¨æˆ·è¾“å…¥(.doc/.docx) â†’ LibreOfficeè½¬æ¢å™¨(PDF) â†’ Pandocè½¬æ¢å™¨(Markdown) â†’ è¾“å‡º

2. **PPTXæ–‡æ¡£å¤„ç†æµç¨‹**ï¼š
   ç”¨æˆ·è¾“å…¥(.pptx) â†’ pptx2mdè½¬æ¢å™¨(Markdown) â†’ è¾“å‡º

3. **æ–‡æœ¬æ–‡ä»¶å¤„ç†æµç¨‹**ï¼š
   ç”¨æˆ·è¾“å…¥(.txt/.md) â†’ ç›´æ¥å¤åˆ¶ â†’ è¾“å‡º

4. **é”™è¯¯å¤„ç†æµç¨‹**ï¼š
   ä¸æ”¯æŒçš„æ ¼å¼ â†’ é”™è¯¯å¤„ç† â†’ é”™è¯¯æç¤º

5. **ä¾èµ–æ£€æŸ¥æµç¨‹**ï¼š
   ç¨‹åºå¯åŠ¨ â†’ ä¾èµ–æ£€æŸ¥ â†’ ä¾èµ–ç¼ºå¤±æç¤º(å¦‚æœ‰ç¼ºå¤±)

6. **ä¸´æ—¶æ–‡ä»¶ç®¡ç†æµç¨‹**ï¼š
   å„è½¬æ¢å™¨ â†’ ä¸´æ—¶æ–‡ä»¶ç®¡ç† â†’ èµ„æºå›æ”¶(è½¬æ¢å®Œæˆåæ¸…ç†)

7. **è´¨é‡éªŒè¯æµç¨‹**ï¼š
   è½¬æ¢è¾“å‡º â†’ è´¨é‡éªŒè¯ â†’ é™çº§å¤„ç†(å¦‚éªŒè¯å¤±è´¥) â†’ è¾“å‡º



## 2. å…³é”®æ¨¡å—è®¾è®¡

### 2.1 è½¬æ¢æ§åˆ¶å™¨è®¾è®¡

#### 2.1.1 æ ¸å¿ƒåŠŸèƒ½
- åè°ƒå„ç»„ä»¶å·¥ä½œæµç¨‹
- å¤„ç†è½¬æ¢è·¯å¾„é€‰æ‹©
- ç®¡ç†ä¸´æ—¶æ–‡ä»¶ç”Ÿå‘½å‘¨æœŸ
- å®ç°é”™è¯¯å¤„ç†å’Œé™çº§ç­–ç•¥

#### 2.1.2 è½¬æ¢æµç¨‹

**Officeæ–‡æ¡£è½¬æ¢æµç¨‹ï¼š**
```
è¾“å…¥éªŒè¯ â†’ ä¾èµ–æ£€æŸ¥ â†’ æ ¼å¼æ£€æµ‹ â†’ è·¯å¾„é€‰æ‹© â†’ 
ç»„ä»¶è°ƒç”¨ â†’ ç»“æœéªŒè¯ â†’ é”™è¯¯å¤„ç† â†’ æ¸…ç†èµ„æº
```

**PPTXæ–‡æ¡£è½¬æ¢æµç¨‹ï¼š**
```
è¾“å…¥éªŒè¯ â†’ ä¾èµ–æ£€æŸ¥ â†’ æ ¼å¼éªŒè¯ â†’ 
pptx2mdè°ƒç”¨ â†’ ç»“æœéªŒè¯ â†’ é”™è¯¯å¤„ç†
```

#### 2.1.3 é”™è¯¯å¤„ç†ç­–ç•¥

**åˆ†å±‚é”™è¯¯å¤„ç†ï¼š**
1. **è¾“å…¥å±‚**ï¼šæ–‡ä»¶å­˜åœ¨æ€§ã€æ ¼å¼æœ‰æ•ˆæ€§éªŒè¯
2. **ä¾èµ–å±‚**ï¼šç»„ä»¶å¯ç”¨æ€§æ£€æŸ¥å’Œå®‰è£…æŒ‡å¯¼
3. **è½¬æ¢å±‚**ï¼šç»„ä»¶è°ƒç”¨é”™è¯¯å’Œå¼‚å¸¸å¤„ç†
4. **è¾“å‡ºå±‚**ï¼šç»“æœè´¨é‡éªŒè¯å’Œé™çº§å¤„ç†

**é™çº§ç­–ç•¥ï¼š**
```bash
process_with_fallback() {
    local input_file="$1"
    local output_file="$2"
    
    # å°è¯•æ ‡å‡†è½¬æ¢
    if process_standard_conversion "$input_file" "$output_file"; then
        if validate_output_quality "$output_file"; then
            return 0
        fi
    fi
    
    # é™çº§å¤„ç†ï¼šæå–çº¯æ–‡æœ¬
    log_warn "æ ‡å‡†è½¬æ¢å¤±è´¥ï¼Œå°è¯•é™çº§å¤„ç†"
    if extract_text_content "$input_file" "$output_file"; then
        log_info "é™çº§å¤„ç†æˆåŠŸï¼Œè¾“å‡ºçº¯æ–‡æœ¬æ ¼å¼"
        return 0
    fi
    
    return 1
}
```

### 2.2 ç»„ä»¶æ¥å£è®¾è®¡

#### 2.2.1 LibreOfficeæ¥å£

**åŠŸèƒ½ï¼š** å°†Officeæ–‡æ¡£è½¬æ¢ä¸ºPDFæ ¼å¼

**æ¥å£å®šä¹‰ï¼š**
```bash
convert_office_to_pdf() {
    local input_file="$1"
    local output_dir="$2"
    
    # è¾“å…¥éªŒè¯
    validate_input_file "$input_file" || return 1
    
    # ä¾èµ–æ£€æŸ¥
    check_libreoffice || return 1
    
    # æ‰§è¡Œè½¬æ¢ï¼ˆå¸¦è¶…æ—¶å’Œé‡è¯•ï¼‰
    local temp_log=$(mktemp)
    local result=1
    
    for attempt in {1..3}; do
        if timeout 60 libreoffice --headless --convert-to pdf \
            --outdir "$output_dir" "$input_file" > "$temp_log" 2>&1; then
            result=0
            break
        fi
        log_warn "LibreOffice è½¬æ¢å°è¯• $attempt å¤±è´¥ï¼Œæ­£åœ¨é‡è¯•..."
        sleep 2
    done
    
    # ç»“æœéªŒè¯
    if [[ $result -eq 0 ]]; then
        validate_pdf_output "$output_dir" "$input_file"
    else
        log_error "LibreOffice è½¬æ¢å¤±è´¥ï¼Œæ—¥å¿—: $(cat "$temp_log")"
    fi
    
    rm -f "$temp_log"
    return $result
}
```

**é”™è¯¯å¤„ç†ï¼š**
- è¾“å…¥æ–‡ä»¶æ ¼å¼éªŒè¯
- LibreOfficeå¯ç”¨æ€§æ£€æŸ¥
- è½¬æ¢è¶…æ—¶å¤„ç†ï¼ˆ60ç§’ï¼‰
- é‡è¯•æœºåˆ¶ï¼ˆæœ€å¤š3æ¬¡ï¼‰
- ç»“æœæ–‡ä»¶éªŒè¯

#### 2.2.2 Pandocæ¥å£ä¿®å¤

**é—®é¢˜åˆ†æï¼š**
å½“å‰å®ç°é”™è¯¯åœ°ä½¿ç”¨ `-f html` å‚æ•°å¤„ç†PDFæ–‡ä»¶ï¼š
```bash
# é”™è¯¯å®ç°
pandoc "$input_file" -f html -t markdown -o "$output_file" --wrap=none
```

**ä¿®å¤æ–¹æ¡ˆï¼š**
```bash
convert_pdf_to_markdown() {
    local input_file="$1"
    local output_file="$2"
    
    # è¾“å…¥éªŒè¯
    validate_pdf_file "$input_file" || return 1
    
    # ä¾èµ–æ£€æŸ¥
    check_pandoc || return 1
    
    # å°è¯•ä½¿ç”¨Pandocçš„PDFæ”¯æŒ
    local temp_log=$(mktemp)
    local result=1
    
    # æ–¹æ¡ˆ1ï¼šå°è¯•PDFè§£æ
    if pandoc "$input_file" -f pdf -t markdown -o "$output_file" --wrap=none > "$temp_log" 2>&1; then
        # éªŒè¯è¾“å‡ºè´¨é‡
        if validate_output_quality "$output_file"; then
            result=0
        else
            log_warn "Pandoc PDFè½¬æ¢è¾“å‡ºè´¨é‡ä¸ä½³"
        fi
    else
        log_warn "Pandoc PDFè½¬æ¢å¤±è´¥ï¼Œå°è¯•é™çº§æ–¹æ¡ˆ"
    fi
    
    # æ–¹æ¡ˆ2ï¼šé™çº§å¤„ç†ï¼ˆå¦‚æœæ–¹æ¡ˆ1å¤±è´¥ï¼‰
    if [[ $result -ne 0 ]]; then
        if extract_text_from_pdf "$input_file" "$output_file"; then
            log_info "ä½¿ç”¨æ–‡æœ¬æå–é™çº§æ–¹æ¡ˆæˆåŠŸ"
            result=0
        fi
    fi
    
    rm -f "$temp_log"
    return $result
}
```

#### 2.2.3 pptx2mdæ¥å£ä¼˜åŒ–

**åŠŸèƒ½å¢å¼ºï¼š**
- è¾“å…¥æ–‡ä»¶æ ¼å¼éªŒè¯
- é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
- è¾“å‡ºè´¨é‡æ£€æŸ¥
- ä¸å…¶ä»–ç»„ä»¶æ¥å£ä¸€è‡´æ€§

**å®ç°ä¼˜åŒ–ï¼š**
```bash
convert_pptx_to_markdown() {
    local input_file="$1"
    local output_file="$2"
    
    # è¾“å…¥éªŒè¯
    validate_pptx_file "$input_file" || return 1
    
    # ä¾èµ–æ£€æŸ¥
    check_pptx2md || return 1
    
    # æ‰§è¡Œè½¬æ¢
    local temp_log=$(mktemp)
    local result=1
    
    if pptx2md "$input_file" --output "$output_file" > "$temp_log" 2>&1; then
        # éªŒè¯è¾“å‡º
        if validate_output_quality "$output_file"; then
            result=0
        else
            log_warn "pptx2mdè½¬æ¢è¾“å‡ºè´¨é‡ä¸ä½³"
        fi
    else
        log_error "pptx2mdè½¬æ¢å¤±è´¥: $(cat "$temp_log")"
    fi
    
    rm -f "$temp_log"
    return $result
}
```

### 2.3 ä¾èµ–æ£€æŸ¥ç³»ç»Ÿè®¾è®¡

#### 2.3.1 æ£€æŸ¥ç­–ç•¥
- **é¢„æ£€æœºåˆ¶**ï¼šç¨‹åºå¯åŠ¨å‰è¿›è¡Œä¾èµ–æ£€æŸ¥
- **è¯¦ç»†æŠ¥å‘Š**ï¼šæä¾›ç¼ºå¤±ç»„ä»¶åˆ—è¡¨å’Œå®‰è£…æŒ‡å¯¼
- **å¹³å°é€‚é…**ï¼šæ”¯æŒä¸åŒæ“ä½œç³»ç»Ÿçš„æ£€æµ‹æ–¹å¼

#### 2.3.2 å®ç°æ–¹æ¡ˆ
```bash
#!/bin/bash
# dependency_checker.sh

check_all_dependencies() {
    local missing_deps=()
    local warnings=()
    
    # æ£€æŸ¥ LibreOffice
    if ! command -v libreoffice &> /dev/null; then
        missing_deps+=("libreoffice")
    else
        # éªŒè¯ç‰ˆæœ¬å’ŒåŠŸèƒ½
        local version=$(libreoffice --version 2>/dev/null | head -1)
        log_info "LibreOfficeç‰ˆæœ¬: $version"
    fi
    
    # æ£€æŸ¥ Pandoc
    if ! command -v pandoc &> /dev/null; then
        missing_deps+=("pandoc")
    else
        local version=$(pandoc --version 2>/dev/null | head -1)
        log_info "Pandocç‰ˆæœ¬: $version"
    fi
    
    # æ£€æŸ¥ pptx2md
    if ! command -v pptx2md &> /dev/null; then
        missing_deps+=("pptx2md")
    else
        local version=$(pptx2md --version 2>/dev/null | head -1)
        log_info "pptx2mdç‰ˆæœ¬: $version"
    fi
    
    # è¿”å›ç»“æœ
    if [[ ${#missing_deps[@]} -gt 0 ]]; then
        show_install_instructions "${missing_deps[@]}"
        return 1
    fi
    
    log_info "æ‰€æœ‰ä¾èµ–æ£€æŸ¥é€šè¿‡"
    return 0
}

show_install_instructions() {
    local missing_deps=("$@")
    
    echo "æ£€æµ‹åˆ°ä»¥ä¸‹ä¾èµ–ç¼ºå¤±ï¼Œè¯·å®‰è£…åé‡è¯•ï¼š"
    echo ""
    
    for dep in "${missing_deps[@]}"; do
        case "$dep" in
            libreoffice)
                echo "ğŸ“„ LibreOffice:"
                echo "  Ubuntu/Debian: sudo apt-get install libreoffice"
                echo "  macOS: brew install --cask libreoffice"
                echo "  CentOS: sudo yum install libreoffice"
                ;;
            pandoc)
                echo "ğŸ“ Pandoc:"
                echo "  Ubuntu/Debian: sudo apt-get install pandoc"
                echo "  macOS: brew install pandoc"
                echo "  CentOS: sudo yum install pandoc"
                ;;
            pptx2md)
                echo "ğŸ“Š pptx2md:"
                echo "  pip install pptx2md"
                echo "  éœ€è¦ Python 3.6+"
                ;;
        esac
        echo ""
    done
}
```

## 3. æ‰¹é‡è½¬æ¢æ¶æ„

### 3.1 å¤„ç†æµç¨‹

```mermaid
sequenceDiagram
    participant User
    participant Main
    participant Collector
    participant Controller
    participant Reporter
    
    User->>Main: æŒ‡å®šè¾“å…¥ç›®å½•
    Main->>Collector: æ”¶é›†æ–‡ä»¶åˆ—è¡¨
    Collector-->>Main: è¿”å›æ–‡ä»¶åˆ—è¡¨å’Œç»Ÿè®¡
    Main->>User: æ˜¾ç¤ºæ–‡ä»¶æ•°é‡å’Œå¤§å°
    User->>Main: ç¡®è®¤å¼€å§‹è½¬æ¢
    
    loop æ¯ä¸ªæ–‡ä»¶
        Main->>Controller: å¤„ç†å•ä¸ªæ–‡ä»¶
        Controller-->>Main: è¿”å›è½¬æ¢ç»“æœ
        Main->>Reporter: æ›´æ–°è¿›åº¦å’Œç»Ÿè®¡
    end
    
    Main->>Reporter: ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š
    Reporter-->>User: æ˜¾ç¤ºè½¬æ¢ç»Ÿè®¡å’Œå¤±è´¥åˆ—è¡¨
```

### 3.2 æ–‡ä»¶æ”¶é›†ç­–ç•¥

```bash
collect_files() {
    local input_dir="$1"
    local recursive="$2"
    local supported_extensions=("doc" "docx" "pptx")
    
    local find_cmd="find \"$input_dir\" -type f"
    
    # æ„å»ºæ‰©å±•åè¿‡æ»¤æ¡ä»¶
    local ext_conditions=()
    for ext in "${supported_extensions[@]}"; do
        ext_conditions+=("-name \"*.$ext\"")
    done
    
    # ç»„åˆæ¡ä»¶
    if [[ ${#ext_conditions[@]} -gt 1 ]]; then
        find_cmd+=" \( ${ext_conditions[0]}"
        for ((i=1; i<${#ext_conditions[@]}; i++)); do
            find_cmd+=" -o ${ext_conditions[i]}"
        done
        find_cmd+=" \)"
    else
        find_cmd+=" ${ext_conditions[0]}"
    fi
    
    # é€’å½’é€‰é¡¹
    if [[ "$recursive" != "true" ]]; then
        find_cmd+=" -maxdepth 1"
    fi
    
    # æ‰§è¡ŒæŸ¥æ‰¾
    eval "$find_cmd" | sort
}
```

### 3.3 è¿›åº¦å’Œç»Ÿè®¡

```bash
process_batch_files() {
    local file_list=("$@")
    local total_count=${#file_list[@]}
    local success_count=0
    local failed_files=()
    local skipped_files=()
    
    log_info "å¼€å§‹æ‰¹é‡è½¬æ¢ï¼Œå…± $total_count ä¸ªæ–‡ä»¶"
    
    for ((i=0; i<total_count; i++)); do
        local input_file="${file_list[i]}"
        local file_num=$((i + 1))
        
        # æ˜¾ç¤ºè¿›åº¦
        printf "\rè¿›åº¦: %d/%d (%.1f%%)" "$file_num" "$total_count" "$(echo "scale=1; $file_num * 100 / $total_count" | bc -l)"
        
        # å¤„ç†æ–‡ä»¶
        local output_file=$(calculate_output_path "$input_file")
        
        if process_single_file "$input_file" "$output_file"; then
            ((success_count++))
        else
            failed_files+=("$input_file")
            log_error "è½¬æ¢å¤±è´¥: $input_file"
        fi
    done
    
    echo ""  # æ¢è¡Œ
    
    # ç”ŸæˆæŠ¥å‘Š
    generate_batch_report "$total_count" "$success_count" "${failed_files[@]}"
}

generate_batch_report() {
    local total="$1"
    local success="$2"
    shift 2
    local failed_files=("$@")
    local failed_count=${#failed_files[@]}
    local success_rate=$(echo "scale=1; $success * 100 / $total" | bc -l)
    
    echo "=================================="
    echo "æ‰¹é‡è½¬æ¢å®ŒæˆæŠ¥å‘Š"
    echo "=================================="
    echo "æ€»æ–‡ä»¶æ•°: $total"
    echo "æˆåŠŸ: $success"
    echo "å¤±è´¥: $failed_count"
    echo "æˆåŠŸç‡: ${success_rate}%"
    echo "=================================="
    
    if [[ $failed_count -gt 0 ]]; then
        echo "å¤±è´¥æ–‡ä»¶åˆ—è¡¨:"
        for file in "${failed_files[@]}"; do
            echo "  - $file"
        done
        echo "=================================="
    fi
}
```

## 4. é”™è¯¯å¤„ç†å’Œæ¢å¤æœºåˆ¶

### 4.1 é”™è¯¯åˆ†ç±»å’Œå¤„ç†

#### 4.1.1 è¾“å…¥é”™è¯¯
- **æ–‡ä»¶ä¸å­˜åœ¨**ï¼šæ£€æŸ¥è·¯å¾„å¹¶æä¾›å»ºè®®
- **æ ¼å¼ä¸æ”¯æŒ**ï¼šæ˜¾ç¤ºæ”¯æŒçš„æ ¼å¼åˆ—è¡¨
- **æ–‡ä»¶æŸå**ï¼šå°è¯•ä¿®å¤æˆ–å»ºè®®é‡æ–°è·å–

#### 4.1.2 ä¾èµ–é”™è¯¯
- **ç»„ä»¶æœªå®‰è£…**ï¼šæä¾›å®‰è£…æŒ‡å¯¼
- **ç‰ˆæœ¬ä¸å…¼å®¹**ï¼šæ˜¾ç¤ºæ¨èç‰ˆæœ¬
- **æƒé™ä¸è¶³**ï¼šæä¾›æƒé™è§£å†³æ–¹æ¡ˆ

#### 4.1.3 è½¬æ¢é”™è¯¯
- **ç»„ä»¶è°ƒç”¨å¤±è´¥**ï¼šè®°å½•è¯¦ç»†æ—¥å¿—ï¼Œæä¾›é‡è¯•
- **è½¬æ¢è¶…æ—¶**ï¼šå¢åŠ è¶…æ—¶æ—¶é—´ï¼Œåˆ†æ‰¹å¤„ç†
- **è¾“å‡ºè´¨é‡å·®**ï¼šé™çº§å¤„ç†ï¼Œæå–çº¯æ–‡æœ¬

### 4.2 æ¢å¤æœºåˆ¶

```bash
# é”™è¯¯å¤„ç†æ¡†æ¶
setup_error_handling() {
    # è®¾ç½®é”™è¯¯é™·é˜±
    trap 'handle_error $? $LINENO' ERR
    trap 'cleanup_on_exit' EXIT
    
    # åˆ›å»ºæ¢å¤ç‚¹
    create_recovery_checkpoint
}

handle_error() {
    local exit_code="$1"
    local line_number="$2"
    local error_context=$(get_error_context)
    
    log_error "ç¨‹åºé”™è¯¯: é€€å‡ºç =$exit_code, è¡Œå·=$line_number"
    log_error "é”™è¯¯ä¸Šä¸‹æ–‡: $error_context"
    
    # å°è¯•æ¢å¤
    if [[ -f "$RECOVERY_CHECKPOINT" ]]; then
        if restore_from_checkpoint; then
            log_info "å·²ä»æ£€æŸ¥ç‚¹æ¢å¤ï¼Œç»§ç»­æ‰§è¡Œ"
            return 0
        fi
    fi
    
    # æ— æ³•æ¢å¤ï¼Œæ¸…ç†é€€å‡º
    cleanup_on_error
    exit $exit_code
}

# å…·ä½“çš„é”™è¯¯å¤„ç†å‡½æ•°
handle_file_error() {
    local file_path="$1"
    local error_type="$2"
    
    case "$error_type" in
        "not_found")
            log_error "æ–‡ä»¶ä¸å­˜åœ¨: $file_path"
            suggest_similar_files "$file_path"
            ;;
        "not_readable")
            log_error "æ–‡ä»¶æ— æ³•è¯»å–: $file_path"
            check_file_permissions "$file_path"
            ;;
        "unsupported_format")
            log_error "ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼: $file_path"
            show_supported_formats
            ;;
        *)
            log_error "æ–‡ä»¶é”™è¯¯: $file_path (ç±»å‹: $error_type)"
            ;;
    esac
}
```

## 5. æ€§èƒ½ä¼˜åŒ–è®¾è®¡

### 5.1 å†…å­˜ç®¡ç†
- **ä¸´æ—¶æ–‡ä»¶åŠæ—¶æ¸…ç†**ï¼šä½¿ç”¨é™·é˜±æœºåˆ¶ç¡®ä¿æ¸…ç†
- **å¤§æ–‡ä»¶åˆ†å—å¤„ç†**ï¼šé¿å…å†…å­˜æº¢å‡º
- **è¿›ç¨‹èµ„æºé™åˆ¶**ï¼šè®¾ç½®åˆç†çš„èµ„æºä¸Šé™

### 5.2 å¹¶å‘å¤„ç†ï¼ˆå¯é€‰ï¼‰
```bash
# å¹¶è¡Œå¤„ç†å®ç°
process_files_parallel() {
    local file_list=("$@")
    local max_jobs=4  # æ ¹æ®CPUæ ¸å¿ƒæ•°è°ƒæ•´
    
    log_info "ä½¿ç”¨å¹¶è¡Œå¤„ç†ï¼Œæœ€å¤§ä½œä¸šæ•°: $max_jobs"
    
    # ä½¿ç”¨GNU parallelæˆ–xargs
    printf '%s\n' "${file_list[@]}" | \
    xargs -P "$max_jobs" -I {} bash -c '
        input_file="{}"
        output_file="${input_file%.*}.md"
        
        if process_single_file "$input_file" "$output_file"; then
            echo "SUCCESS: $input_file"
        else
            echo "FAILED: $input_file" >&2
        fi
    ' | while IFS= read -r line; do
        if [[ "$line" == SUCCESS:* ]]; then
            ((success_count++))
        elif [[ "$line" == FAILED:* ]]; then
            failed_files+=("${line#FAILED: }")
        fi
        
        # æ›´æ–°è¿›åº¦æ˜¾ç¤º
        show_progress "$success_count" "$total_count"
    done
}
```

## 6. è´¨é‡ä¿è¯æœºåˆ¶

### 6.1 è¾“å‡ºè´¨é‡éªŒè¯
```bash
validate_conversion_quality() {
    local input_file="$1"
    local output_file="$2"
    local min_quality_score=60
    
    # å¤šç»´åº¦è´¨é‡æ£€æŸ¥
    local checks=(
        "check_file_exists:$output_file"
        "check_min_size:$output_file:100"  # æœ€å°100å­—èŠ‚
        "check_content_validity:$output_file"
        "check_structure_integrity:$output_file"
    )
    
    local quality_score=0
    local total_checks=${#checks[@]}
    
    for check in "${checks[@]}"; do
        IFS=':' read -r check_type check_args <<< "$check"
        
        if perform_quality_check "$check_type" "$check_args"; then
            ((quality_score += 100 / total_checks))
        fi
    done
    
    if [[ $quality_score -ge $min_quality_score ]]; then
        log_info "è´¨é‡æ£€æŸ¥é€šè¿‡: ${quality_score}%"
        return 0
    else
        log_warn "è´¨é‡æ£€æŸ¥æœªé€šè¿‡: ${quality_score}% (è¦æ±‚: ${min_quality_score}%)"
        return 1
    fi
}
```

### 6.2 æµ‹è¯•ç­–ç•¥
- **å•å…ƒæµ‹è¯•**ï¼šæ¯ä¸ªæ¨¡å—ç‹¬ç«‹æµ‹è¯•
- **é›†æˆæµ‹è¯•**ï¼šæ¨¡å—é—´åä½œæµ‹è¯•
- **ç«¯åˆ°ç«¯æµ‹è¯•**ï¼šå®Œæ•´æµç¨‹æµ‹è¯•
- **æ€§èƒ½æµ‹è¯•**ï¼šå¤§æ–‡ä»¶å’Œæ‰¹é‡å¤„ç†æµ‹è¯•
- **å…¼å®¹æ€§æµ‹è¯•**ï¼šä¸åŒå¹³å°å’Œç»„ä»¶ç‰ˆæœ¬æµ‹è¯•

è¿™ä¸ªæŠ€æœ¯è®¾è®¡æ–‡æ¡£æä¾›äº†å®Œæ•´çš„ç³»ç»Ÿæ¶æ„ã€è¯¦ç»†çš„å®ç°æ–¹æ¡ˆå’Œå…¨é¢çš„è´¨é‡ä¿è¯æœºåˆ¶ï¼Œä¸ºé¡¹ç›®çš„ç¨³å®šå®ç°æä¾›äº†åšå®çš„æŠ€æœ¯åŸºç¡€ã€‚